<!DOCTYPE html>
<html>
  <head>
    <title>JavaScript Sandbox</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://unpkg.com/ncloudchat/ncloudchat.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  </head>

  <body>
    <script>
      let nc = null;
      $(document).ready(function () {
        const projectId = $("#projectId").val();
        const userId = $("#userId").val();
        const name = $("#name").val();
        const profile = $("#profile").val();
        const token = $("#token").val();
        const serverUrl = $("#serverUrl").val();
        const socketUrl = $("#socketUrl").val();
        $("#projectId").val(localStorage.getItem("projectId"));
        $("#userId").val(localStorage.getItem("userId"));
        $("#name").val(localStorage.getItem("name"));
        $("#token").val(localStorage.getItem("token"));
        $("#profile").val(localStorage.getItem("profile"));
        $("#serverUrl").val(localStorage.getItem("serverUrl"));
        $("#socketUrl").val(localStorage.getItem("socketUrl"));
        nc = new ncloudchat.Chat(true);
        
        $("#btnInitialize").on("click", function () {
          const projectId = $("#projectId").val();
          const serverUrl = $("#serverUrl").val();
          const socketUrl = $("#socketUrl").val();
          localStorage.setItem("projectId", projectId);
          localStorage.setItem("serverUrl", serverUrl);
          localStorage.setItem("socketUrl", socketUrl);
          if (!$("#projectId").val()) {
            alert("ProjectId is empty");
            $("#projectId").focus();
            return false;
          }
          if (!serverUrl) {
            alert("server url is empty");
            return false;
          }
          if (!socketUrl) {
            alert("socket url is empty");
            return false;
          }
          nc.initialize(projectId);
          nc.setLang("en");
          nc.setServerUrl(serverUrl);
          nc.setSocketUrl(socketUrl);
          console.log("initialize(" + projectId + ", " + serverUrl + ", " + socketUrl + ")");
         alert("initialize(" + projectId + ", " + serverUrl + ", " + socketUrl + ")");
       });
       $("#btnConnect").on("click", async function () {
          const userId = $("#userId").val();
          const name = $("#name").val();
          const profile = $("#profile").val();
          const customField = $("#customField").val();
          const token = $("#token").val();
          localStorage.setItem("userId", userId);
          localStorage.setItem("name", name);
          localStorage.setItem("profile", profile);
          localStorage.setItem("customField", customField);
          localStorage.setItem("token", token);
          if (!$("#userId").val()) {
            alert("UserId is empty");
            $("#userId").focus();
            return false;
          }
          try {
            const connection = await nc.connect(
              {
                id: userId,
                name: name,
                profile: profile,
                language: "en",
                customField: customField,
                token: token
              }
            );
            const output = JSON.stringify(connection);
            console.log(output);
            alert(output);
          } catch (e) {
            console.log("error : " + e.message);
            alert("error : " + e.message);
          }
       });
       $("#btnGetUsers").on("click", async function () {
          const userId = $("#userId").val();
          localStorage.setItem("userId", userId);
          if (!$("#userId").val()) {
            alert("UserId is empty");
            $("#userId").focus();
            return false;
          }
          try {
            const filter = { id: userId };
            const sort = { created_at: -1 };
            const option = { offset: 0, limit: 100 };
            const members = await nc.getUsers(filter, sort, option);
            const output = JSON.stringify(members);
            console.log(output);
            alert(output);
          } catch (e) {
            console.log("error : " + e.message);
            alert("error : " + e.message);
          }
       });
      });
      
       
                                  
       async function clickConnect() {
        try {
          await nc.connect({
            id: radevJsSandbox,
            name: radevJsSandbox,
            language: en,
          });
        } catch (e) {
          console.log(e);
          alert("error: " + e);
        }
      }

      async function clickGetUsers() {
        try {
          const filter = { id: "radevUnityAOS" };
          const sort = { created_at: -1 };
          const option = { offset: 0, limit: 100 };
          const members = await nc.getUsers(filter, sort, option);
          alert("id : " + members.id);
          alert("name : " + members.name);
        } catch (e) {
          console.log(e);
          alert("error: " + e);
        }
      }

    </script>
      <div>
        <input type="text" class="form-control" id="projectId" placeholder="projectId" value="" required="">
        <input type="text" class="form-control" id="userId" placeholder="userId" value="" required="">
        <input type="text" class="form-control" id="name" placeholder="name" value="" required="">
      </div>
      <div>
        <input type="text" class="form-control" id="profile" placeholder="profile" value="" required="">
        <input type="text" class="form-control" id="customField" placeholder="customField" value="">
        <input type="text" class="form-control" id="token" placeholder="token" value="" required="">
      </div>
      <div>
        <select id="serverUrl" name="serverUrl" class="form-select" aria-label="Default select">
                <option value="https://dash-api.ncloudchat.com">Alpha</option>
                <option value="https://dashboard-api.beta-ncloudchat.naverncp.com">Beta</option>
                <option value="https://ncloudchat.apigw.ntruss.com/gpapps/v1">Real</option>
        </select>
        <select id="socketUrl" name="socketUrl" class="form-select" aria-label="Default select">
                <option value="https://soc.ncloudchat.com">Alpha</option>
                <option value="https://soc.beta-ncloudchat.ntruss.com">Beta</option>
                <option value="https://soc.ncloudchat.ntruss.com">Real</option>
        </select>
      </div>
    <button id="btnInitialize">initialize</button>
    <button id="btnConnect">Connect</button>
    <button id="btnGetUsers">getUsers</button>
  </body>
</html>
